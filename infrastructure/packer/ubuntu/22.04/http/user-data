#cloud-config
# vim: syntax=yaml
#
# This is the user-data configuration for cloud-init.
# It runs on the first boot of the instance.

# Set hostname
hostname: ${hostname}
# Preserve hostname changes
preserve_hostname: false

# Default user configuration
users:
  - name: ${ssh_username}
    sudo: ALL=(ALL) NOPASSWD:ALL # Grant sudo access without password
    groups: [sudo, admin]
    shell: /bin/bash
    lock_passwd: true # Disable password login, rely on SSH keys
    ssh_authorized_keys:
      - ${ssh_public_key} # Inject the public key provided as a variable

# Package management
package_update: true  # Update package list on first boot
package_upgrade: true # Upgrade all packages on first boot

# Optional: Install additional packages
# packages:
#   - qemu-guest-agent
#   - curl
#   - git

# Optional: Run commands on first boot
# runcmd:
#   - [ systemctl, enable, qemu-guest-agent ]
#   - [ systemctl, start, qemu-guest-agent ]

# Final message
final_message: "The system is finally up, after $UPTIME seconds"